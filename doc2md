#!/bin/bash

# doc2md - Convert DOCX files in current directory to Markdown.
# Usage: doc2md <base-name>
# Example: doc2md ali-baba
# Requires: pandoc

set -e

if [ -z "$1" ]; then
  echo "Usage: doc2md <base-name>"
  exit 1
fi

if ! command -v pandoc &> /dev/null; then
  echo "‚ùå Pandoc not found. Please install it first:"
  echo "   brew install pandoc"
  exit 1
fi

BASE_NAME="$1"
OUTPUT_DIR="output"

mkdir -p "$OUTPUT_DIR"

DOCX_FILES=(*.docx)

if [ ${#DOCX_FILES[@]} -eq 0 ]; then
  echo "‚ùå No .docx files found in the current directory."
  exit 1
fi

COUNTER=1
for DOCX_FILE in "${DOCX_FILES[@]}"; do
  NUM=$(printf "%03d" "$COUNTER")
  FOLDER_NAME="${BASE_NAME}-${NUM}"
  FOLDER_PATH="${OUTPUT_DIR}/${FOLDER_NAME}"
  mkdir -p "$FOLDER_PATH"
  MD_FILE="${FOLDER_PATH}/${FOLDER_NAME}.md"

  pandoc "$DOCX_FILE" -t markdown -o "$MD_FILE"

  echo "‚úÖ Converted: $DOCX_FILE ‚Üí $MD_FILE"
  ((COUNTER++))
done

echo "üéâ Done! Markdown files are in the '$OUTPUT_DIR' folder."
